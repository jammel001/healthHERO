<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>B. Magaji — HealthChero</title>
  <link rel="stylesheet" href="/static/style.css">
</head>

<body>
<div class="page">

  <!-- Header -->
  <header class="topbar">
    <div class="brand">
      <div class="logo">BM</div>
      <div class="brand-text">
        <h1>B. Magaji — HealthChero</h1>
        <p class="muted">Built by Bara'u Magaji &amp; team</p>
      </div>
    </div>

    <nav class="top-actions">
      <a class="link" href="/guidelines" target="_blank">Guidelines</a>
      <button id="restartBtn" class="btn small">Start Over</button>
    </nav>
  </header>

  <!-- Main -->
  <main class="container">
    <section class="left">

      <div class="card chatcard">
        <div id="chatWindow" class="chat-window"></div>

        <div class="controls">
          <input id="chatInput"
                 placeholder="Type your message here and press Enter…">
          <button id="sendBtn" class="btn">Send</button>
        </div>

        <div class="hint">
          This assistant provides medical guidance, not diagnosis.
        </div>
      </div>

      <div class="card actions">
        <button id="simplePdf" class="btn">Download PDF</button>
      </div>

    </section>
  </main>

  <footer class="footer">
    <div>
      Contact:
      <a href="mailto:admin@healthchero.com">admin@healthchero.com</a>
    </div>
  </footer>

</div>

<script>
/* ======================
   ELEMENTS
====================== */
const chatWindow = document.getElementById('chatWindow');
const chatInput  = document.getElementById('chatInput');
const sendBtn    = document.getElementById('sendBtn');
const restartBtn = document.getElementById('restartBtn');

/* ======================
   STATE
====================== */
let conversationStarted = false;

/* ======================
   UI HELPERS
====================== */
function appendMessage(role, text) {
  const div = document.createElement('div');
  div.className = 'msg ' + role;
  div.textContent = text;
  chatWindow.appendChild(div);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

function renderOptions(options) {
  const box = document.createElement('div');
  box.className = 'options';

  options.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'btn small';
    btn.textContent = opt;
    btn.onclick = () => sendMessage(opt.toLowerCase());
    box.appendChild(btn);
  });

  chatWindow.appendChild(box);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

/* ======================
   CORE LOGIC
====================== */
async function sendMessage(text) {
  if (!text) return;

  appendMessage('user', text);
  chatInput.value = '';

  const payload = conversationStarted
    ? { reply: text }
    : { symptoms: text };

  conversationStarted = true;

  try {
    const res = await fetch('/api/diagnose', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (data.text) appendMessage('ai', data.text);
    if (data.items) data.items.forEach(i => appendMessage('ai', i));
    if (data.advice) appendMessage('ai', data.advice);
    if (data.disclaimer) appendMessage('ai', data.disclaimer);
    if (data.options) renderOptions(data.options);

  } catch (e) {
    appendMessage('ai', '⚠️ Unable to reach server. Please try again.');
  }
}

/* ======================
   EVENTS
====================== */
sendBtn.onclick = () => sendMessage(chatInput.value.trim());

chatInput.addEventListener('keydown', e => {
  if (e.key === 'Enter') sendBtn.click();
});

restartBtn.onclick = () => {
  chatWindow.innerHTML = '';
  conversationStarted = false;
  greetUser();
};

/* ======================
   INITIAL GREETING
====================== */
function greetUser() {
  appendMessage(
    'ai',
    'Welcome to Healthchero chatbot, a healthcare conversational assistant. ' +
    'You can start interacting by saying Assalamu,alaikum or HELLO'
  );
}

greetUser();
</script>

</body>
</html>


