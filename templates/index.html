<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Health Assistant</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="chat-container">
    <div id="chat-box">
      <div class="ai">ğŸ©º Hello! Iâ€™m your AI Health Assistant, created by Baraâ€™u Magaji Kanya.</div>
      <div class="ai">Letâ€™s begin. What is your name?</div>
    </div>

    <form id="chat-form">
      <input type="text" id="user-input" placeholder="Type your answer..." autocomplete="off" required />
      <button type="submit">Send</button>
    </form>
  </div>

  <script>
    const form = document.getElementById("chat-form");
    const input = document.getElementById("user-input");
    const chatBox = document.getElementById("chat-box");

    const steps = ["name", "age", "gender", "location", "symptoms", "days"];
    let userData = {};
    let currentStep = 0;

    const aiQuestions = {
      name: "ğŸ‘¤ What is your name?",
      age: "ğŸ‚ How old are you?",
      gender: "âš§ï¸ What is your gender (Male/Female/Other)?",
      location: "ğŸ“ Where are you currently located?",
      symptoms: "ğŸ’¬ Please list your symptoms (comma-separated)",
      days: "â³ How many days have you had these symptoms?"
    };

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const inputText = input.value.trim();
      if (!inputText) return;

      chatBox.innerHTML += `<div class="user">${inputText}</div>`;
      input.value = "";

      const key = steps[currentStep];
      userData[key] = inputText;
      currentStep++;

      if (currentStep < steps.length) {
        const nextKey = steps[currentStep];
        setTimeout(() => {
          chatBox.innerHTML += `<div class="ai">${aiQuestions[nextKey]}</div>`;
          chatBox.scrollTop = chatBox.scrollHeight;
        }, 500);
      } else {
        chatBox.innerHTML += `<div class="ai">ğŸ” Diagnosing your symptoms, please wait...</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;

        const res = await fetch("/diagnose", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(userData)
        });
        const result = await res.json();

        const prescriptionText = `
Patient Name: ${result.name}
Age: ${result.age}
Gender: ${result.gender}
Location: ${result.location}

Likely Illness: ${result.disease}
Description: ${result.description}

Severity:
${result.severity}

Precautions:
${result.precautions.join('\n')}

Doctor Advice:
${result.location_advice}

Health Tip:
${result.health_tip}

Generated by AI Assistant (Baraâ€™u Magaji Kanya)
        `;
        const prescriptionBlob = new Blob([prescriptionText], { type: "text/plain" });
        const prescriptionUrl = URL.createObjectURL(prescriptionBlob);

        setTimeout(() => {
          chatBox.innerHTML += `
            <div class="ai">
              âœ… <strong>Diagnosis for ${result.name}</strong><br>
              ğŸ‘¤ Age: ${result.age} | âš§ï¸ Gender: ${result.gender}<br>
              ğŸ“ Location: ${result.location}<br><br>

              ğŸ©º <strong>Possible Disease:</strong> <em>${result.disease}</em><br>
              ğŸ“– <strong>Description:</strong> ${result.description}<br><br>

              ğŸš¨ <strong>Severity:</strong><br>${result.severity.replace(/\n/g, "<br>")}<br><br>

              ğŸ§´ <strong>Precautions:</strong>
              <ul>${result.precautions.map(p => `<li>${p}</li>`).join("")}</ul>

              ${result.location_advice}<br><br>

              ğŸŒ± <strong>${result.health_tip.replace(/\n/g, "<br>")}</strong><br><br>

              <a href="${prescriptionUrl}" download="prescription.txt" class="download-btn">â¬‡ï¸ Download Your Prescription</a><br><br>

              ğŸ¤– ${result.followup}<br>
              <button onclick="location.reload()">ğŸ” Yes, start again</button>
            </div>`;
          chatBox.scrollTop = chatBox.scrollHeight;
        }, 1000);
      }
    });
  </script>
</body>
</html>
